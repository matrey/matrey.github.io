<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>China Mirrors - matrey.github.io</title><meta name="gridsome:hash" content="7ddacdcd2aa86913199a1c494f3cc2d236efdde9"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.20"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Here is how to increase the speed of Debian, Docker, Node, PHP, Python setups, by using mirrors hosted inside China."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.ddb52ad4.css" as="style"><link rel="preload" href="/assets/js/app.1a4cf688.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.35c724b6.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.d7419f00.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.32c3d1f4.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.8b69c806.js"><link rel="stylesheet" href="/assets/css/0.styles.ddb52ad4.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← matrey.github.io
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">
      China Mirrors
    </h1><div class="post-meta">
   Posted 27 August 2020, updated 15 October 2020.
   <strong>5 min read.</strong></div></div><div class="post content-box"><div class="post__header"><img alt="Cover image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 414 247' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-c7367608b5d782c01ac238092cd29186'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-c7367608b5d782c01ac238092cd29186)' width='414' height='247' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAmCAYAAAB0xJ2ZAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAJ90lEQVRo3s3a144UyRIG4H4h3oCH4A5xgYQE4gK4AIEWrhALSBghFm%2bE994u3i/em4XFe%2b9h8T7P%2bVKKVk1NzfQwgM5JqVQ93ZUm/vjjj8isqaX/tm/fvuUrPrfWGv1e1b5%2b/drm8dvSimN971Ucw1Ur/mCh2pcvX9KDBw/S%2bfPn05kzZ9Lly5fTP//8k/%2b%2bcuVKunr1arp27Vq6dOlSun79erp9%2b3a6detWvt%2b/f7/%2b%2benTp%2bnVq1fNJv1ZV3vBK/atlVF98uRJOn78eDb69evX9d%2bA4gpvtraAeAYAADt37lz6Fc16nj17lh4%2bfJivR48epcePH6fnz5%2bnd%2b/epU%2bfPuWruO7iGl21f//9N3v5woUL6eTJk2nv3r31zrxp8Tdv3kwnTpzIrDDIsWPH0o0bNzITXLwNuHv37uUFvHnzJrPg/fv36ePHj3mcnTt35jlc%2bly8eDH9/fff%2bQK4MeM6depUXpO7363B3z67nz59Oq/HZTxstEZz%2bgx0jI3%2bnmebv2OuI0eO5LXmEAjqozjjobpu3bq0YsWKtHr16rR27dr0559/ZgAMbIJNmzblQV0mOXz4cJo6dWqaOXNm7nvo0KE0Z86c9OLFizy2xfISVgHL5MD3N6Bc4ZVfEQIt9W8SAgDQ7ty5k/bs2ZMNX7lyZfaAkLBgSO/YsSMtXbo0o08DeNx97ty5acuWLWnbtm3ZG4sWLcpgacIBU35mC0MCuJYAbK1/ExEkah8%2bfMiXuMGGiCusYISG0nfv3s3AvHz5MgPAuP379%2bffP3/%2bnMcKo43P06gfsfuzBbG9V60ogGFYMSNoaL9kyZK0devWbBgwxNCaNWvS8uXL08KFCzPlfVdU/WIT80LgZ6XCn9Vq5QWdPXs2vX37tlla3LhxYw4RQkIbZs%2benak%2bfvz4NH/%2b/Ex34ETM6xMttKMM7I/k/p8FZLM0iPZFxY8FR3qUHVBfbMsEWIPmKO7vAEDznbCgC5gV7PiRHP4jBVlDBhTvDJQ%2bpB30ZSQtoA%2bNGkGUatavX58mTJiQwwdTjNdeFvxSBjQaVGHBgzwc1aFQEC7S44wZM3Lq0/fAgQNZG/TBAEASyu3bt///AlA1cFvzLTDkf2FDCNUFQoTgEUvK765u8GxrWaDKqPJv5X3Fj4JQa0vNXLXYEDlGzZo1KwOAIUIEM4QLBqgpsAEDos5o63xFQMqsib9/FIRaezsWq0cZgGgKEwYDIMpSWnD06NG0atWqnDV8F9UklhDXonBWgRBzAVdBhlFlcKp0rBGozQBo5PVy9aWpBpctW5apzijG0wN3xmJCbEjclbwMkWoBprIkmsImgChXdJpxVKVCTFaJoqrIjGK/Mhjl8ZoUQm3dZxcHi4ntAzZs2JA/M8gCGdmenR2RZGgV05Tf2BWpWl0STegJsypbqgS3aEvtew48qn7jOQywuH379uUymEcBYQf4119/5X48xkDM8B3m0A3ZBHPsJDX9hAzNUGJH2717d/0Z9QQWRDPvggULcp1y8ODBJo6KGsYu17iRxptthsrIxJZVjPOybW3U%2bUpfOz2L9bu0ZzcoBWpobcFCgYH60ITY/gJCXSFr0AOhYt8gBDwfAAmZMELBBRSNlhgnmjRLiEePHp1GjBhRf06zl7EOIHCScr5FBhSpHmJFxHgqqjixu3jx4mwgQfKcWgDtPd/SXqBR413sYExVA%2bLgwYNT//7962V1ZCIgbd68Of8%2bcuTI7Olou3btqoeOhjlR6leGQCBuQZQdE6S6iOtyGKCvSi9SneqPd7CAMQBBZVtpz8Su0h0LMIhBni86AuNoirGCTfYgQKcHUVRhCSf98ccfafLkyZkJ06dPr//O4ABA1gntaDEEAgCGmyyqPhMVn%2bGR2OWNGzcus2To0KFp0qRJGRCxKCR4Rn86YV8AWBrBYIJH0Io5vbyPoDGesdESRiGC4h0oHTt2TH379s3fARor%2bvTpkzp06JBBNh/AAA3AYFhlFiguQuxAjAfFT9UhRGQBqEc%2btwgTWiB1ZgAP8k6jAxHj6lOl3GI3RDHWaNzff/89A1r8HrDqDvQXDg5vevfuncO1GDqVALSk9uWKKwbhadTHECED9UhnAEF7qBPOOB0qH64GoGJz1KhRWQCD3iFyKB5ZwLPF7XbxWfMBBeswWAkuTTvdirOOZgcibakFyiDEAtDceYAYZ7A7AKLKi7M/1WKUwlUny0LNYgcMGFBPp8EE6TQOVovhUgxFcwKft6dMmZKFGZvCaGNaR9mO2vfuAcoTS39SotMgdOMlsQsAYgcEXiGOcTxepHjkZSFjkZ06dcpCFd6WGULVCVroQIwR4kyDzNe5c%2bdsPLqrHIEmNUaxVj4erzXacTVqcjbvRlk8ceLEzAp05n0AWJijs4jBUHmNghM8NYFG2Hr16pVFEsj0JIqfyO/F9cogwAYUMMW%2bVKhGQXsijAlV%2b4MWD0SiER1xHS8dpJOoDUzoe%2bpOBFVakWoYI96D/uirUiuWq9jgN2EBLAs2v3ifNm1a/n7evHm5yDKX2sNJdayT540hWxmXGAsBIPTr1y8LI93p1q1b7h%2bMLe8i6%2b8FIqYNEJuTOPaOlw0MkW4smNd4NmLfwmNwcccAQBjDc47MYxcXu0j93M3JECBrPM2TQimqR2MVKzzrBTCnuOsb5w3Un9eB5%2bxSauYk6y9rUBMNiHM/Xo%2bHiw1tIyVCnfHFys%2biykdm1FitYCHFKi9SWhRMjIgdHvB5X%2bzyppDAulB7V3jUZxphDIZHqaw2Eff6AY8GFdN5PQQYwcMQizjkKbFNUQ0eaYvgoRNxQUdi482RfkBTrCg25GxGRxMe0pix4qUqY90t0MJ5O17CCAeqbhx6ItVG/U/sjOM76%2bEw2cPfQPMcQR47dmzO/V26dEldu3bNAGCIvsYkjphaQ2noxSGFxiAPjxkzJseR33nWwEICur4HApAsnCeNQRN4GzDFYilOjHnBhbJYFJewMl5xB0jxaYrfq16w8n6RcfpG9ii/wAlGR/hyPEY3CYFQZJPymol5NqgbB6FFdfdMTGoSY/jdxCbAJh5tSzMX5likOYcMGZIPXIcNG5ZDAYiMLlai5RI%2bgBEiw4cPz86Qpnv27JnXBLAomnIIFDtjA%2boRpvBMueKq8gJFjiKIJlgo8YN81PJl8WnpwIXxxM5Ba48ePXIoyv%2bDBg1K3bt3r6e0lt4BAlxoSoUDBw7M/YXNb7/9ljOJkAmxrWeBcgqEvnAQo2gd7wcwwOe4o3b844Sy0/PxTjCOvqoqzLYceWNDABcCa9yqjVOxHycAnaaUt9ZVx2W1lhZQ9jJKVV3f%2b%2b8xjQCoOgcos7ClIq21/lVvlZqkwdbO/dr63r2119Nt/d%2bj4lhVXm7t/UHxuSqjq8aoteedQKM4/l%2b8/W20iWup/QcoLbIQemIIMgAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="414" data-src="/assets/static/2020-08-27-npminstall.0e597b4.61257c16ff17ed7a7e88a579494adba9.png" data-srcset="/assets/static/2020-08-27-npminstall.0e597b4.61257c16ff17ed7a7e88a579494adba9.png 414w" data-sizes="(max-width: 414px) 100vw, 414px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/2020-08-27-npminstall.0e597b4.61257c16ff17ed7a7e88a579494adba9.png" class="g-image g-image--loaded" width="414" alt="Cover image"></noscript></div><div class="post__content"><p>Here is how to increase the speed of Debian, Docker, Node, PHP, Python setups, by using mirrors hosted inside China.</p>
<p>Note that regardless of where you are on the planet, you should also consider caching. That will be the topic of an upcoming article.</p>
<h2 id="debian"><a href="#debian" aria-hidden="true"><span class="icon icon-link"></span></a>Debian</h2>
<p>As of 2020-08-27, the <a href="https://www.debian.org/mirror/list-full#CN" target="_blank" rel="nofollow noopener noreferrer">Debian mirror list</a> mentions the following "Push-Primary" instances:</p>
<ul>
<li>ftp2.cn.debian.org</li>
<li>ftp.cn.debian.org</li>
<li>mirrors.tuna.tsinghua.edu.cn <strong>&#x3C;&#x3C; my pick since March 2020</strong></li>
<li>mirrors.ustc.edu.cn</li>
</ul>
<p>Rewrite your <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">sources.list</code> with:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">sed -i </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">s#http://deb.debian.org/debian#http://mirrors.tuna.tsinghua.edu.cn/debian#</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> /etc/apt/sources.list</span>
<span style="color: #D8DEE9FF">sed -i </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">s#http://security.debian.org/debian-security#http://mirrors.tuna.tsinghua.edu.cn/debian-security#</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> /etc/apt/sources.list</span></code></pre>
<h2 id="docker"><a href="#docker" aria-hidden="true"><span class="icon icon-link"></span></a>Docker</h2>
<h3 id="docker-setup-on-debianubuntu"><a href="#docker-setup-on-debianubuntu" aria-hidden="true"><span class="icon icon-link"></span></a>Docker setup on Debian/Ubuntu</h3>
<p><a href="https://mirror.tuna.tsinghua.edu.cn/help/docker-ce/" target="_blank" rel="nofollow noopener noreferrer">Tuna</a> has a mirror of <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">docker-ce</code> for China</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">curl -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9FF"> apt-key add -</span>
<span style="color: #D8DEE9FF">add-apt-repository </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu </span><span style="color: #ECEFF4">$(</span><span style="color: #A3BE8C">lsb_release -cs</span><span style="color: #ECEFF4">)</span><span style="color: #A3BE8C"> stable</span><span style="color: #ECEFF4">"</span>
<span style="color: #D8DEE9FF">apt-get update -y</span>
<span style="color: #D8DEE9FF">apt-get install -y docker-ce docker-ce-cli containerd.io</span>
<span style="color: #D8DEE9FF">systemctl start docker</span>
<span style="color: #D8DEE9FF">systemctl </span><span style="color: #88C0D0">enable</span><span style="color: #D8DEE9FF"> docker</span></code></pre>
<h3 id="docker-registry"><a href="#docker-registry" aria-hidden="true"><span class="icon icon-link"></span></a>Docker registry</h3>
<ul>
<li>As of 2020, Docker once-official <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">registry.docker-cn.com</code> is dead.</li>
<li>Azure CN offered a mirror <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">https://dockerhub.azk8s.cn</code>, but it was closed to public access in early 2020 (cf <a href="https://github.com/Azure/container-service-for-azure-china/commit/a3d0ef5c544b447d5e2728289ccca0f6464e045c" target="_blank" rel="nofollow noopener noreferrer">April 22nd 2020 commit</a> "currently .azk8s.cn could only be accessed by Azure China IP, we don't provide public outside access any more.")</li>
<li>NetEase mirror <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">https://hub-mirror.c.163.com</code> (thanks <a href="https://gist.github.com/y0ngb1n/7e8f16af3242c7815e7ca2f0833d3ea6" target="_blank" rel="nofollow noopener noreferrer">https://gist.github.com/y0ngb1n/7e8f16af3242c7815e7ca2f0833d3ea6</a>) still works as of 2020-08-29</li>
</ul>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #88C0D0">echo</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">{"registry-mirrors": ["https://hub-mirror.c.163.com/"]}</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> /etc/docker/daemon.json</span>
<span style="color: #D8DEE9FF">systemctl restart docker</span></code></pre>
<p>Note that if the mirror is unavailable, Docker will fallback to the default address for Docker Hub.
The error message on pull makes you believe the mirror is not used:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">docker: Error response from daemon: Get https://registry-1.docker.io/v2/: net/http: TLS handshake timeout.</span></code></pre>
<p>But <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">journalctl -xe</code> reveals it tried the mirror first (thanks <a href="https://stackoverflow.com/questions/42143395/docker-registry-mirror-not-used" target="_blank" rel="nofollow noopener noreferrer">https://stackoverflow.com/questions/42143395/docker-registry-mirror-not-used</a>):</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">Aug 29 14:43:31 mathieu-TM1701 dockerd[1631]: time=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">2020-08-29T14:43:31.909534014+08:00</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> level=info msg=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Attempting next endpoint for pull after error: error parsing HTTP 403 response body: invalid character '&lt;'</span>
<span style="color: #A3BE8C"> looking for beginning of value: </span><span style="color: #EBCB8B">\"</span><span style="color: #A3BE8C">&lt;html&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;body bgcolor=</span><span style="color: #EBCB8B">\\\"</span><span style="color: #A3BE8C">white</span><span style="color: #EBCB8B">\\\"</span><span style="color: #A3BE8C">&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;hr&gt;&lt;center&gt;nginx/1.14.0 (Ubuntu)&lt;/cen</span>
<span style="color: #A3BE8C">ter&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;/body&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n&lt;/html&gt;</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">r</span><span style="color: #EBCB8B">\\</span><span style="color: #A3BE8C">n</span><span style="color: #EBCB8B">\"</span><span style="color: #ECEFF4">"</span>
<span style="color: #D8DEE9FF">Aug 29 14:43:42 mathieu-TM1701 dockerd[1631]: time=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">2020-08-29T14:43:42.168132298+08:00</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> level=warning msg=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Error getting v2 registry: Get https://registry-1.docker.io/v2/: net/http: TLS handshake timeout</span><span style="color: #ECEFF4">"</span>
<span style="color: #D8DEE9FF">Aug 29 14:43:42 mathieu-TM1701 dockerd[1631]: time=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">2020-08-29T14:43:42.168255578+08:00</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> level=info msg=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Attempting next endpoint for pull after error: Get https://registry-1.docker.io/v2/: net/http: TLS handsha</span>
<span style="color: #A3BE8C">ke timeout</span><span style="color: #ECEFF4">"</span>
<span style="color: #D8DEE9FF">Aug 29 14:43:42 mathieu-TM1701 dockerd[1631]: time=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">2020-08-29T14:43:42.168351623+08:00</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> level=error msg=</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Handler for POST /v1.40/images/create returned error: Get https://registry-1.docker.io/v2/: net/http: TLS</span>
<span style="color: #A3BE8C"> handshake timeout</span><span style="color: #ECEFF4">"</span></code></pre>
<h2 id="node"><a href="#node" aria-hidden="true"><span class="icon icon-link"></span></a>Node</h2>
<h3 id="npm-registry"><a href="#npm-registry" aria-hidden="true"><span class="icon icon-link"></span></a>NPM registry</h3>
<p>Taobao has a mirror of npm within China</p>
<p>One shot:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">npm --registry https://registry.npm.taobao.org install express</span></code></pre>
<p>To make it persistent on the user:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">npm config </span><span style="color: #88C0D0">set</span><span style="color: #D8DEE9FF"> registry https://registry.npm.taobao.org</span></code></pre>
<p>Or by directly writing the configuration file at <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">~/.npmrc</code></p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #88C0D0">echo</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">registry=https://registry.npm.taobao.org</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.npmrc</span></code></pre>
<h2 id="php"><a href="#php" aria-hidden="true"><span class="icon icon-link"></span></a>PHP</h2>
<h3 id="composer-setup"><a href="#composer-setup" aria-hidden="true"><span class="icon icon-link"></span></a>Composer setup</h3>
<p>Based on <a href="https://getcomposer.org/doc/faqs/how-to-install-composer-programmatically.md" target="_blank" rel="nofollow noopener noreferrer">How to install Composer programmatically</a> and <a href="https://pkg.phpcomposer.com/" target="_blank" rel="nofollow noopener noreferrer">https://pkg.phpcomposer.com/</a>:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">php -r </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">copy('https://install.phpcomposer.com/installer', 'composer-setup.php');</span><span style="color: #ECEFF4">"</span>
<span style="color: #D8DEE9FF">php composer-setup.php --quiet</span>
<span style="color: #D8DEE9FF">php -r </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">unlink('composer-setup.php');</span><span style="color: #ECEFF4">"</span></code></pre>
<p><em>Comparing <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">https://getcomposer.org/installer</code> with <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">https://install.phpcomposer.com/installer</code> out of curiosity:</em></p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">645c645</span>
<span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">         </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">this</span><span style="color: #D8DEE9FF">-</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">baseUrl = </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">uriScheme</span><span style="color: #D8DEE9FF">.</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">://getcomposer.org</span><span style="color: #ECEFF4">'</span><span style="color: #81A1C1">;</span>
<span style="color: #D8DEE9FF">---</span>
<span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">         </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">this</span><span style="color: #D8DEE9FF">-</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">baseUrl = </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">uriScheme</span><span style="color: #D8DEE9FF">.</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">://install.phpcomposer.com</span><span style="color: #ECEFF4">'</span><span style="color: #81A1C1">;</span>
<span style="color: #D8DEE9FF">827c827</span>
<span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">         </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">url</span><span style="color: #D8DEE9FF"> = </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">this</span><span style="color: #D8DEE9FF">-</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">baseUrl.</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">/versions</span><span style="color: #ECEFF4">'</span><span style="color: #81A1C1">;</span>
<span style="color: #D8DEE9FF">---</span>
<span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">         </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">url</span><span style="color: #D8DEE9FF"> = </span><span style="color: #81A1C1">$</span><span style="color: #D8DEE9">this</span><span style="color: #D8DEE9FF">-</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">baseUrl.</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">/versions.json</span><span style="color: #ECEFF4">'</span><span style="color: #81A1C1">;</span></code></pre>
<p>Make composer available to the local user with:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">mkdir -p </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.local/bin/</span>
<span style="color: #D8DEE9FF">mv composer.phar </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.local/bin/composer</span></code></pre>
<h3 id="packagist-mirror"><a href="#packagist-mirror" aria-hidden="true"><span class="icon icon-link"></span></a>Packagist mirror</h3>
<p>As of 2020-08-27, the <a href="https://packagist.org/mirrors" target="_blank" rel="nofollow noopener noreferrer">Packagist mirror page</a> lists:</p>
<ul>
<li>mirrors.huaweicloud.com/repository/php</li>
<li>developer.aliyun.com/composer <strong>&#x3C;&#x3C; works OK</strong></li>
<li>php.cnpkg.org</li>
<li>packagist.phpcomposer.com</li>
<li>packagist.mirrors.sjtug.sjtu.edu.cn</li>
<li>mirrors.cloud.tencent.com/help/composer.html <strong>&#x3C;&#x3C; works OK</strong></li>
</ul>
<p>Apply with the <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">composer config</code> command:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span></code></pre>
<p>Or you can directly write into <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">~/.config/composer/config.json</code>:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">mkdir -p </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.config/composer/</span>
<span style="color: #88C0D0">echo</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">{"repositories":{"packagist":{"type":"composer","url":"https://mirrors.aliyun.com/composer/"}}}</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.config/composer/config.json</span></code></pre>
<h2 id="python"><a href="#python" aria-hidden="true"><span class="icon icon-link"></span></a>Python</h2>
<h3 id="pip--pypi"><a href="#pip--pypi" aria-hidden="true"><span class="icon icon-link"></span></a>pip / PyPI</h3>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">pip config </span><span style="color: #88C0D0">set</span><span style="color: #D8DEE9FF"> global.index-url </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">https://pypi.tuna.tsinghua.edu.cn/simple</span><span style="color: #ECEFF4">"</span></code></pre>
<p>Or to avoid running pip (for instance in a Dockerfile, as it would pollute the image), write directly to <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">~/.config/pip/pip.conf</code></p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #D8DEE9FF">mkdir -p </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.config/pip/</span>
<span style="color: #88C0D0">echo</span><span style="color: #D8DEE9FF"> -e </span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF">/.config/pip/pip.conf</span></code></pre>
<h2 id="ubuntu-cloud-images"><a href="#ubuntu-cloud-images" aria-hidden="true"><span class="icon icon-link"></span></a>Ubuntu cloud images</h2>
<p>Equivalent to <a href="https://cloud-images.ubuntu.com/" target="_blank" rel="nofollow noopener noreferrer">https://cloud-images.ubuntu.com/</a></p>
<ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/" target="_blank" rel="nofollow noopener noreferrer">https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/</a></li>
<li><a href="https://mirrors.nju.edu.cn/ubuntu-cloud-images/" target="_blank" rel="nofollow noopener noreferrer">https://mirrors.nju.edu.cn/ubuntu-cloud-images/</a></li>
<li><a href="https://mirrors.ustc.edu.cn/ubuntu-cloud-images/" target="_blank" rel="nofollow noopener noreferrer">https://mirrors.ustc.edu.cn/ubuntu-cloud-images/</a> (though as of 2020-10-15, it was still offering the 2020-09-22 <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">bionic</code> image while 2020-10-14 is available)</li>
</ul>
<hr>
<p><em>Cover image adapted from <a href="https://xkcd.com/303/" target="_blank" rel="nofollow noopener noreferrer">https://xkcd.com/303/</a> ; Creative Commons Attribution-NonCommercial 2.5 License</em></p>
</div><div class="post__footer"><div class="post-tags"><a href="/tag/programming/" class="post-tags__link"><span>#</span> programming
		</a><a href="/tag/china/" class="post-tags__link"><span>#</span> china
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-236b518cdbc14f0d29271c268ab2e5d7'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-236b518cdbc14f0d29271c268ab2e5d7)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAgMAAwEAAAAAAAAAAAAABgcABQgBAwQJ/8QANBAAAQMDAwEGBgECBwAAAAAAAQIDBAAFEQYSIQcTMUFRcZEIFCIyYYEjFcIkU2JyobHR/8QAGQEAAgMBAAAAAAAAAAAAAAAAAgQBAwUA/8QAHBEAAwEAAwEBAAAAAAAAAAAAAAECEQMSITET/9oADAMBAAIRAxEAPwDVNSpSe%2bIrqW9omzxrbalbLtcUrIe/yWhwVD/UScDy5Nccjs6kdbrNpe4SbRb0mbdmTtcOP4mleRPiR5D3pLXvq1qy8ur3XN6Ewr7BGHZpA9U80tNOaW1BqyQt%2b3xlyCpZK3XTwo55yTTGZ6G6rU0lfzEZoqwFIbUcY/PhVbtfNL443m4c2vrLqyyPHsrr8%2bhA3FqaA4lYPkrgj1BrQfSDqnB6iRZLYjKg3SKEqdjqWFBSTn6kHgkcc5AxkVn66dCNSR4QLM2K%2bsDOzJBH4zil%2b/YtR6Lujch0PwJKVHs5DKykpI8lCum1806%2bKvuH0IqUB9F9Zua10YzNm7RcmFliUkAD6gAQrA8CDmjyrCglZJ%2bMVDqtbWQqH8Qt52evaKz/AG1ras%2bfFjamJsSwyGx/jG3FNq472lKSO/8A3Ee5qG8XoUp08Rx0MbbRo2ChKAk8k8d%2bT304GN4QngYpEs6gc0rGESKwna2jCEhsrUQlOTgD0NE%2bhtfyr7MZjuRlsreTuRuQpBx4ZBpNPHppqdSQz5AWptXAApI9fYiHdLLVgb21Becfmr3W3UOXYJsiKmMXSyNy8IUogcc4HrQ5eLyNYWx6C%2bwMutlKxtKSglORkHkeBqG/VSJ6%2bOSy%2bD6eHbJf4akjtGnmlheOSkpUMH0IPvWhqz/8I9tTEst9kuZEh55CSCD9qdwz759q0BTqeoy6TT9JSz6z29yVGiuIH0BKt305JCSFY9eKZleO622LdIio01vtGic4BII/YobnssD4eT87VCo09Fh3BtLi20qcwMK8cGrlmKzGvEZplKEkDfmhWyP/ANCekw5Syn5ZbjfPfhJIH/FUmor4Lxc4bsKUllUdYVtU5tJI7s45pN%2bPDUh9kMN%2bBGmXSQmQlKl53bs1V3yNCtzDjzbaEu45XjnHrQvYL41Z58n5t/tXJCisjtCrnxIzVteHRfZ1vgNqVslPNtqx5E8j8cZqF74Tb6r0Lui1sct1gfCwAFrB4GOTlX9wpiV5bbAj22ImPERsaTyBkk%2b5r1U9C6rDJ5b726RK6LhMYt8GRMmOJajR21OuuK7kpSMk%2b1DWpuomltNhxNzvEYPo72GT2rufLanOP3ikX1W66RNRacn2Ky22Q01MT2S5UhYSoJyCcITnvxjk0WFZSXfqPE1PqefdLfDVEgfMJbHaqypRCfuIA%2bncPDnGKadiWzMtzTsX5dhxaAoISkUjNAWODOsUmO2o75J3OnPKXAf/ADFXVtt%2bprK9sjL7ZrBSN2cY9RSV46Zo8TqJQ2dQSWrdbXVyHWVubcfUBjP6oF6e65tsTqXaY113rblLcZYfyNqXlYSkkeXJTnwKqG51q1LfZATcn%2bzjKP1BHAx/2aCNcIZhaihtwjtXBbABB%2b1Wdw/eeaLjldweem4bN%2b1KyxpT4jL3Gbbbv9ujXJA%2b51o9g6fUcpP6Apt6Y616PvYSh%2baq1yDx2c1OwZ/CxlPuRTmCB//Z' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.2f4ae0769631e4cb3ccb068279a05d8f.jpg" data-srcset="/assets/static/author.e6b6009.2f4ae0769631e4cb3ccb068279a05d8f.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.2f4ae0769631e4cb3ccb068279a05d8f.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript><!----><p class="author__intro">
		
	</p><p class="author__links"><a href="https://www.linkedin.com/in/matrey/">LinkedIn</a><a href="https://github.com/matrey/">GitHub</a></p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2020. </span><span class="footer__links">Powered by <a href="//gridsome.org"> Gridsome </a></span></footer></div>
    <script src="/assets/js/app.1a4cf688.js" defer></script><script src="/assets/js/page--src--templates--post-vue.35c724b6.js" defer></script>
  </body>
</html>